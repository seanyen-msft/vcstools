# Continuous integration procedure for AppVeyor
# Based on https://github.com/rmcgibbo/python-appveyor-conda-example

environment:

  matrix:
    - PYTHON: "C:\\Python27-x64"
    - PYTHON: "C:\\Python35-x64"
    - PYTHON: "C:\\Python36-x64"

install:
  - set PATH=%PYTHON%\Scripts;%PYTHON%;%PATH%
  - python --version
  - python -m pip install -U pip setuptools wheel nose mock
  - python setup.py install
  - ps: |
      Start-FileDownload 'http://liquidtelecom.dl.sourceforge.net/project/gnuwin32/bzip2/1.0.5/bzip2-1.0.5-setup.exe'
      Start-FileDownload 'http://liquidtelecom.dl.sourceforge.net/project/gnuwin32/libarchive/2.4.12-1/libarchive-2.4.12-1-setup.exe'
      .\bzip2-1.0.5-setup.exe /VERYSILENT
      .\libarchive-2.4.12-1-setup.exe /VERYSILENT
  - SET PATH=C:\Program Files (x86)\GnuWin32\bin\;%PATH%
  - mklink "C:\Program Files (x86)\GnuWin32\bin\tar.exe" "C:\Program Files (x86)\GnuWin32\bin\bsdtar.exe"
  - python -m pip install -U bzr --global-option build_ext --global-option --allow-python-fallback
  - bzip2 --help
  - where tar
  - hg --version
  - bzr --version
  - git --version
  - svn --version
  - echo "import sys; sys.setdefaultencoding('utf-8'); print('mytest')" > %PYTHON%\Lib\site-packages\sitecustomize.py
  - python -c "import sys; print(sys.getdefaultencoding())"

build: none

test_script:
  # Nosetests take care of unit tests
  - python -m nose --with-xunit

on_finish:
  - ps: |
      $wc = New-Object 'System.Net.WebClient'
      $wc.UploadFile("https://ci.appveyor.com/api/testresults/junit/$($env:APPVEYOR_JOB_ID)", (Resolve-Path .\nosetests.xml))
